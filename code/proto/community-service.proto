syntax = "proto3";

package community;

option go_package = "community-service/src/pb;pb";

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

service CommunityService {
  rpc ListCommunities(ListCommunitiesRequest) returns (ListCommunitiesResponse);
  rpc CreateCommunity(CreateCommunityRequest) returns (Community);
  rpc GetCommunity(GetCommunityRequest) returns (Community);
  rpc UpdateCommunity(UpdateCommunityRequest) returns (Community);
  rpc DeleteCommunity(DeleteCommunityRequest) returns (google.protobuf.Empty);
  rpc UploadCommunityIcon(UploadCommunityIconRequest) returns (Community);
  rpc JoinCommunity(JoinCommunityRequest) returns (google.protobuf.Empty);
  rpc LeaveCommunity(LeaveCommunityRequest) returns (google.protobuf.Empty);
  rpc ListCommunityMembers(ListCommunityMembersRequest) returns (ListCommunityMembersResponse);
}

message Community {
  string id = 1;
  string owner_id = 2;
  string name = 3;
  string description = 4;
  string icon_url = 5;
  google.protobuf.Timestamp created_at = 6;
  google.protobuf.Timestamp updated_at = 7;
}

message Pagination {
  int32 current_page = 1;
  int32 per_page = 2;
  int32 total_items = 3;
  int32 total_pages = 4;
}

message ListCommunitiesRequest {
  int32 page = 1;
  int32 page_size = 2;
  string owner_id = 3;
  string search = 4;
  string sort_by = 5;
  string sort_order = 6;
}

message ListCommunitiesResponse {
  repeated Community communities = 1;
  Pagination pagination = 2;
}

message CreateCommunityRequest {
  string name = 1;
  string description = 2;
}

message GetCommunityRequest {
  string id = 1;
}

message UpdateCommunityRequest {
  string id = 1;
  string name = 2;
  string description = 3;
}

message DeleteCommunityRequest {
  string id = 1;
}

message UploadCommunityIconRequest {
  string id = 1;
  bytes icon = 2;
  string mime_type = 3;
}

message JoinCommunityRequest {
  string id = 1;
}

message LeaveCommunityRequest {
  string id = 1;
}

message ListCommunityMembersRequest {
  string id = 1;
  int32 page = 2;
  int32 page_size = 3;
}

message ListCommunityMembersResponse {
  repeated string member_ids = 1;
  Pagination pagination = 2;
}
